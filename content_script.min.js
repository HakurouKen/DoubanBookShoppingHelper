var utils=function(a,b,c){var d=function(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase(1)},e=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},f=function(a){var b=(a.method||"get").toString().toUpperCase(),d=a.url||"",f=e(a.data||{}),g=(a.beforeSend||a.beforesend||function(){},a.fail||function(){},a.success||function(){}),h=a.fail||function(){};d+="GET"===b&&""!==f?"?"+f:"";var i=new XMLHttpRequest;return i.open("GET",d,!0),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?g(i.responseText,i.status):h(i.status))},i.send("GET"===b?c:f),i},g={},h=function(a,c){var d=/\W/.test(a)?new Function("obj","var paras = [];with(obj){ paras.push('"+a.replace(/\s/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("paras.push('").split("\r").join("\\'")+"');}return paras.join('');"):g[a]=g[a]||h(b.getElementById(a).innerHTML);return c?d(c):d},i=function(a,b,c){return Array.prototype.every.call(a,function(a,d,e){return b(a,d,e),c?!1:!0})},j=function(a){var c=b.createElement("div");return c.innerHTML=a.trim(),c.childNodes[0]};return{type:d,serialize:e,ajax:f,renderTpl:h,toDom:j,every:i}}(window,document),douban=function(a,b){var c=function(a,b){return a?utils.ajax({method:"get",url:"http://api.douban.com/v2/book/isbn/"+a,success:b}):null},d=function(a,c){return a=a||null,utils.ajax({method:"get",url:"http://book.douban.com/subject/"+a+"/buylinks",success:function(a){var d=b.createElement("div"),e=[];d.innerHTML=a||"";for(var f=b.evaluate('//table[@id="buylink-table"]/tbody/tr',d,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null),g=/[0-9]+(\.[0-9]+)?/,h=1,i=f.snapshotLength;i>h;h++){var j=f.snapshotItem(h),k=j.querySelectorAll("td.pl2"),l={site:k[0].textContent.trim(),href:k[0].getElementsByTagName("a")[0].href,price:g.exec(k[1].textContent.trim())[0]};e.push(l)}c&&c(e)}})};return{getInfo:c,getPrice:d}}(window,document);!function(a,b){function c(){var a=d.curSite.getISBN();douban.getInfo(a,function(a){var b=JSON.parse(a);d.insert(b)})}var d=function(a,b){function c(a,c,d,e){utils.ajax({url:chrome.extension.getURL("dist/style/"+a+".min.css"),success:function(a){var c=b.createElement("style");c.innerHTML=a,b.body.appendChild(c)}}),utils.ajax({url:chrome.extension.getURL("dist/template/"+a+".tpl"),success:function(a){d="string"===utils.type(d)?b.querySelector(d):d,e="string"===utils.type(e)?b.querySelector(e):e;var f=utils.renderTpl(a,c),g=utils.toDom(f),h=e?e.nextElementSibling:null;h?d.insertBefore(g,h):d.appendChild(g)}})}var d,e={name:"amazon",cName:"亚马逊",checker:/^(https?:\/\/)?(www)?\.amazon\.(com|cn)\/.*/,getISBN:function(){var a,c=b.querySelectorAll("#detail_bullets_id .content li b");try{utils.every(c,function(b){"ISBN:"===b.textContent&&(a=b.nextSibling.textContent.split(",")[0].substring(1))},a)}catch(d){}return a},insertTo:function(){return b.getElementById("centerCol")||function(a){var b=a.getElementById("productGuarantee").parentNode;return b.style.lineHeight="22px",b}(b)},insertAfter:function(){return b.getElementById("tellAFriendJumpbar_feature_div")}},f={name:"jd",cName:"京东商城",checker:/^(https?:\/\/)?item\.jd\.com\/\d+\.html.*/,getISBN:function(){var a,c=b.querySelectorAll("#product-detail-1 .detail-list li");try{Array.prototype.every.call(c,function(b){return b.textContent.indexOf("ISBN")>=0&&(a=b.textContent.split("：",2)[1]),a?!1:!0})}catch(d){}return a},insertTo:function(){return b.getElementById("summary")}},g={name:"dangdang",cName:"当当网",checker:/^(https?:\/\/)?product\.dangdang\.com\/\d+\.html.*/,getISBN:function(){var a,c=b.querySelectorAll('.book_messbox[name="Infodetail_pub"]>div');try{Array.prototype.every.call(c,function(b){return"ＩＳＢＮ"===b.querySelector(".show_info_left").textContent&&(a=b.querySelector(".show_info_right").textContent),a?!1:!0})}catch(d){}return a},insertTo:function(){return b.querySelector(".book_messbox[name=Infodetail_pub]")}},h=[e,f,g],i=location.href;return utils.every(h,function(a){("regexp"===utils.type(a.checker)?a.checker.test(i):i.indexOf(a.checker.toString())>-1)&&(d=a)},d),{support:h,curSite:d,insert:function(a){c(d.name,a,d.insertTo(),d.insertAfter&&d.insertAfter())}}}(a,b);c()}(window,document);